<!DOCTYPE html>
<html lang="en">
<head>
	<title>Product Progress</title>

	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
<!--===============================================================================================-->	
	<link rel="icon" type="image/png" href="images/icons/favicon.ico"/>
<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="vendor/bootstrap/css/bootstrap.min.css">
<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="fonts/font-awesome-4.7.0/css/font-awesome.min.css">
<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="fonts/iconic/css/material-design-iconic-font.min.css">
<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="vendor/animate/animate.css">
<!--===============================================================================================-->	
	<link rel="stylesheet" type="text/css" href="vendor/css-hamburgers/hamburgers.min.css">
<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="vendor/animsition/css/animsition.min.css">
<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="vendor/select2/select2.min.css">
<!--===============================================================================================-->	
	<link rel="stylesheet" type="text/css" href="vendor/daterangepicker/daterangepicker.css">
<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="css/util.css">
	<link rel="stylesheet" type="text/css" href="css/main.css">
<!--===============================================================================================-->
    <style>
    .company-name {
        font-family: 'Raleway', sans-serif;
        font-size: 1.6em;
        font-weight: 700;
        color: #8B4513;
        text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        letter-spacing: 0.5px;
        text-transform: uppercase;
    }
    .footer-company-name {
        font-family: 'Raleway', sans-serif;
        font-size: 0.9em;
        font-weight: 500;
        color: #666;
    }
    .contact-company-name {
        font-family: 'Raleway', sans-serif;
        font-size: 1.6em;
        font-weight: 700;
        margin-bottom: 20px;
        line-height: 1.4;
        color: #8B4513;
        text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        letter-spacing: 0.5px;
        text-transform: uppercase;
    }
    .contact-company-name strong {
        color: #D2691E;
        font-weight: 800;
        letter-spacing: 0.5px;
        display: block;
        margin-bottom: 5px;
    }
    .contact-section {
        padding: 30px 0;
        background: linear-gradient(to right, #FFF8DC, #FFE4B5);
        box-shadow: 0 2px 15px rgba(0,0,0,0.1);
    }
    .contact-section h2 {
        margin-bottom: 25px;
        font-weight: 700;
    }
    .contact-section h3 {
        color: #8B4513;
        font-size: 1.3em;
        font-weight: 600;
        margin-bottom: 20px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    .contact-section p {
        margin-bottom: 15px;
        line-height: 1.6;
        color: #5C4033;
        font-weight: 500;
    }
    .contact-description {
        font-size: 1.15em;
        color: #5C4033;
        font-weight: 500;
        line-height: 1.8;
        margin-bottom: 25px;
        font-style: italic;
        padding: 15px;
        background: rgba(255,255,255,0.5);
        border-radius: 5px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    }
    .contact-info {
        font-size: 1.1em;
        color: #8B4513;
        font-weight: 500;
        line-height: 2;
        margin-bottom: 15px;
        padding: 8px 15px;
        background: rgba(255,255,255,0.5);
        border-radius: 5px;
        transition: all 0.3s ease;
    }
    .contact-info:hover {
        background: rgba(255,255,255,0.8);
        transform: translateX(5px);
    }
    .contact-info i {
        color: #D2691E;
        margin-right: 15px;
        font-size: 1.2em;
        width: 25px;
        text-align: center;
        vertical-align: middle;
    }
    address {
        margin-top: 20px;
    }
    #footer {
        background: linear-gradient(to right, #FFF8DC, #FFE4B5);
        padding: 20px 0;
        box-shadow: 0 -2px 15px rgba(0,0,0,0.1);
    }
    #crowd {
        font-family: 'Raleway', sans-serif;
        font-size: 1.6em;
        font-weight: 700;
        color: #8B4513;
        text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        letter-spacing: 0.5px;
        text-transform: uppercase;
        text-align: center;
        margin: 20px 0;
    }
    .progress {
        height: 25px;
        margin: 15px 0;
        border-radius: 5px;
        background-color: #f5f5f5;
        box-shadow: inset 0 1px 2px rgba(0,0,0,.1);
    }
    .progress-bar {
        line-height: 25px;
        color: #fff;
        text-align: center;
        background-color: #3CB371;
        box-shadow: inset 0 -1px 0 rgba(0,0,0,.15);
        transition: width .6s ease;
    }
    .booking-card {
        background: #fff;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        padding: 20px;
        margin-bottom: 20px;
        transition: transform 0.2s ease;
    }
    .booking-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0,0,0,0.15);
    }
    .booking-card h4 {
        color: #333;
        margin-bottom: 15px;
        font-weight: 600;
    }
    .booking-card p {
        color: #666;
        margin-bottom: 10px;
    }
    .booking-card .linkstyle {
        color: #3CB371;
        text-decoration: none;
        font-weight: 500;
        display: inline-block;
        margin-top: 10px;
    }
    .booking-card .linkstyle:hover {
        color: #2E8B57;
        text-decoration: underline;
    }
    </style>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.0/jquery.min.js"></script>

    <script src="js/tabsSearch.js"></script>
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Roboto'>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

<!--Product Pie Progress-->
<link rel="stylesheet" href="/progressBar/dist/css/asPieProgress.css">
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
<script src="path/to/jquery-asPieProgress.js"></script>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="js/config.js"></script>

<script>
$(document).ready(function(){
  $("#myInput").on("keyup", function() {
    var value = $(this).val().toLowerCase();
    $("#myTable tr td div").filter(function() {
      $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
    });
  });
});

$('#bookingBtn').click(async(event) => {           
			// Change serviceURL to your own
			var username = $('#bookingtxt').val();

			var serviceURL = "http://13.250.108.137:8000/handleorders/productprogress/" + username ;
			  try {
            const response =
             await fetch(serviceURL, { method: 'GET' });
            const data = await response.json();

           var userbookings = data.UserBookings
            if (!userbookings || !userbookings.length) {
               

            } else {
	
						var printrow ='' 
			
                // for loop to setup all table rows with obtained book data
                for (const ubooks of userbookings) {
				
						var printrow = 
						"<span><h4>Booking ID " + ubooks.bookingID + ":</h4><b>Start Date :</b><i>" + ubooks.projStartDate +  "</i><br><b>End Date :</b><i>  " + ubooks.projEndDate + "</i><small> " + ubooks.productProgress  + "%</small></span><div class='progress'><div class='progress-bar progress-bar-danger' role='progressbar' aria-valuenow=' " + ubooks.productProgress +  "' aria-valuemin='0' aria-valuemax='100' style='width:" + ubooks.productProgress.toString()+"%;'></div></div><a class='linkstyle' href='moreinfo.php?bookingID="+ubooks.bookingID +"' target='_blank'>More Info</a>";

					// append here 
					$("#solutionProducts").append(printrow);
                }

            }
        } catch (error) {
            showError
            ('There is a problem retrieving books data, please try again later.<br />'+error);
                } 
		});

</script>

</head>
<body>
	<div class="limiter">
		<div class="container-login100">
			<div class="wrap-login100 p-t-85 p-b-20">
				<div style="text-align: center; margin-bottom: 20px;">
					<span id="crowd" style="font-size: 20px;">
						<strong>Kennettechnologies software & IT solutions</strong>
					<br><br>
					<i style="font-size: 18px;">Product Progress</i>
				</div>
				<div id="errorContainer" class="alert alert-danger" style="display: none; margin-top: 20px;"></div>
				<div id="successContainer" class="alert alert-success" style="display: none; margin-top: 20px;"></div>

				<div class="wrap-input100 validate-input m-t-85 m-b-35">
					<input id="bookingtxt" class="input100" type="text" placeholder="Enter Username" required />
				</div>

				<div class="container-login100-form-btn">
					<button id="bookingBtn" style="background-color:#3CB371" type="button" class="login100-form-btn">
						Check Progress
					</button>
				</div>

				<div id="solutionProducts" class="mt-4" style="margin-top: 30px;"></div>
			</div>
		</div>
	</div>

	<script>
		// Utility functions
		function showError(message) {
			const errorContainer = $('#errorContainer');
			errorContainer.text(message).show();
			$('#successContainer').hide();
		}

		function showSuccess(message) {
			const successContainer = $('#successContainer');
			successContainer.text(message).show();
			$('#errorContainer').hide();
		}

		function formatDate(dateString) {
			const date = new Date(dateString);
			return date.toLocaleDateString('en-US', {
				year: 'numeric',
				month: 'long',
				day: 'numeric'
			});
		}

		function createProgressBar(progress) {
			return `
				<div class="progress">
					<div class="progress-bar" 
						 role="progressbar" 
						 aria-valuenow="${progress}" 
						 aria-valuemin="0" 
						 aria-valuemax="100" 
						 style="width: ${progress}%;">
						${progress}%
					</div>
				</div>`;
		}

		// Handle booking button click
		$('#bookingBtn').click(async function() {
			const username = $('#bookingtxt').val().trim();
			
			if (!username) {
				showError(config.ERROR_MESSAGES.INVALID_INPUT);
				return;
			}

			try {
				const response = await apiHelper.fetchWithAuth(
					`${config.API_BASE_URL}${config.ENDPOINTS.PRODUCT_PROGRESS}/${username}`
				);

				const userbookings = response.UserBookings;
				const solutionProducts = $('#solutionProducts');
				solutionProducts.empty();

				if (!userbookings || !userbookings.length) {
					showSuccess('No bookings found for this user.');
					return;
				}

				userbookings.forEach(booking => {
					const bookingHtml = `
						<div class="booking-card">
							<h4>Booking ID: ${booking.bookingID}</h4>
							<p><strong>Start Date:</strong> ${formatDate(booking.projStartDate)}</p>
							<p><strong>End Date:</strong> ${formatDate(booking.projEndDate)}</p>
							${createProgressBar(booking.productProgress)}
							<a class="linkstyle" href="moreinfo.php?bookingID=${booking.bookingID}" target="_blank">
								More Info
							</a>
						</div>`;
					solutionProducts.append(bookingHtml);
				});

				showSuccess('Progress information loaded successfully.');
			} catch (error) {
				showError(apiHelper.handleError(error));
			}
		});

		// Handle browser back/forward cache
		window.addEventListener("pageshow", function(event) {
			const historyTraversal = event.persisted || 
				(typeof window.performance != "undefined" && 
				window.performance.navigation.type === 2);
			if (historyTraversal) {
				window.location.reload();
			}
		});
	</script>

	<!-- Vendor JS -->
	<script src="vendor/jquery/jquery-3.2.1.min.js"></script>
	<script src="vendor/animsition/js/animsition.min.js"></script>
	<script src="vendor/bootstrap/js/popper.js"></script>
	<script src="vendor/bootstrap/js/bootstrap.min.js"></script>
	<script src="vendor/select2/select2.min.js"></script>
	<script src="vendor/daterangepicker/moment.min.js"></script>
	<script src="vendor/daterangepicker/daterangepicker.js"></script>
	<script src="vendor/countdowntime/countdowntime.js"></script>
	<script src="js/main.js"></script>
</body>
</html>